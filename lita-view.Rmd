---
title: "LITA Tweets"
author: "James L. Adams"
date: "11/15/2016"
output: html_document
---

```{r setup, include=FALSE, echo = FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(lubridate)
library(tidytext)
library(plotly)
library(ggthemes)
library(DT)

files_raw <- list.files("~/Box Sync/lita-tweets", pattern = "*-raw.csv", full.names = TRUE)
tweets_raw <- lapply(files_raw, read_csv)
df_raw <- bind_rows(tweets_raw)

df <- df_raw %>%
  mutate(created = as.POSIXct(created_at, 
                              format="%a %b %d %H:%M:%S +0000 %Y", 
                              tz="GMT", 
                              origin="1970-01-01"
                              )
         ) %>%
  select(screen_name, id_str, created, text, lang, geo_enabled, retweet_count, time_zone)

users_tweets_per_day <- df %>%
  group_by(day = date(created)) %>%
  summarize(users = length(unique(screen_name)), tweets = length(text)) %>%
  gather(variable, value, users:tweets)


df_tidy <- df %>%
  unnest_tokens(output = word, input = text) %>%
  anti_join(stop_words)

df_sentiment <- df_tidy %>%
  left_join(get_sentiments(lexicon = "nrc")) %>%
  filter(!is.na(sentiment)) %>%
  group_by(sentiment, day = wday(created, label = TRUE), time = floor_date(created,unit = "minutes")) %>%
  summarize(frequency = n()) %>%
  arrange(desc(frequency))

sent_day_specific <- df_sentiment %>%
  filter(!(sentiment %in% c("positive", "negative"))) %>%
  group_by(day, sentiment) %>%
  summarize(frequency = sum(frequency))

sent_day_generic <- df_sentiment %>%
  filter((sentiment %in% c("positive", "negative"))) %>%
  group_by(day, sentiment) %>%
  summarize(frequency = sum(frequency))

sent_time_specific <- df_sentiment %>%
  filter(!(sentiment %in% c("positive", "negative")))

sent_time_generic <- df_sentiment %>%
  filter((sentiment %in% c("positive", "negative")))

```

## LITA Forum 2016 {.tabset}

During the LITA Forum 2016 so far we've had `r length(df$id_str)` tweets using the hashtag #litaforum.

This is how those tweets break down, and how they look when their words are mapped to the [NRC Word-Emotion Association Lexicon](http://saifmohammad.com/WebPages/NRC-Emotion-Lexicon.htm).

Last updated `r stamp("Tuesday, November 15, 2016 at 12:07 pm")(now())`. Code is available (badly commented) on [GitHub](http://github.com/jladams/lita-view).

### Overview
```{r overview, echo = FALSE}
people <- ggplot(users_tweets_per_day, aes(x = day, y = value, color = variable)) +
  geom_line() +
  geom_point() +
  theme_hc() +
  scale_color_hc() +
  labs(x = "Date", y = "", title = "Unique Users vs. Tweets")

ggplotly(people)
```


### Sentiment Frequency by Day

```{r sent_day, echo = FALSE}
sentiment_freq_generic <- ggplot(sent_day_generic, aes(x = sentiment, y = frequency)) +
  geom_bar(aes(fill = sentiment), stat = "identity") +
  facet_grid(.~day) +
  theme_hc() +
  scale_fill_hc(guide = FALSE) +
  geom_text(aes(label = frequency), vjust = 0) +
  labs(title = "Positive vs. Negative", x = "")


sentiment_freq_specific <- ggplot(sent_day_specific, aes(x = sentiment, y = frequency)) +
  geom_bar(aes(fill = sentiment), stat = "identity") +
  facet_wrap(~ day) +
  theme_hc() +
  scale_fill_economist(guide = FALSE) +
  geom_text(aes(label = frequency), vjust = 0) +
  labs(title = "Specific Emotions", x = "") +
  theme(axis.text.x = element_text(angle = 90, hjust = 1, vjust = .5))

print(sentiment_freq_generic)
print(sentiment_freq_specific)

lubridate::stamp
```

### Sentiment Frequency by Time
```{r sent_time, echo = FALSE}
sent_lines_generic <- ggplot(sent_time_generic, aes(x = time, y = frequency)) +
  geom_line(aes(color = sentiment, group = sentiment)) +
  geom_point(aes(color = sentiment)) +
  facet_grid(day~.) +
  theme_hc() +
  scale_color_hc() +
  labs(title = "Positive vs. Negative", x = "")

sent_lines_specific <- ggplot(sent_time_specific, aes(x = time, y = frequency)) +
  geom_line(aes(color = sentiment, group = sentiment)) +
  geom_point(aes(color = sentiment)) +
  facet_grid(day~.) +
  theme_hc() +
  scale_color_economist() +
  labs(title = "Specific Emotions", x = "") +
  theme(legend.position = "bottom")

ggplotly(sent_lines_generic) %>% layout(legend = list(x = 1.05, y = 1))
ggplotly(sent_lines_specific) %>% layout(legend = list(x = 1.05, y = 1))

```

### Raw Data
```{r data, echo = FALSE}
datatable(df_raw, class = "cell-border stripe")
```
